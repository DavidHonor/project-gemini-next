generator client {
  provider = "prisma-client-js"
}
generator zod {
  provider = "npx zod-prisma-types"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
    id String @id @unique
    email String @unique

    File File[]
    Message Message[]
    Rocket Rocket[]

    stripeCustomerId String? @unique @map(name: "stripe_customer_id")
    stripeSubscriptionId String? @unique @map(name: "stripe_subscription_id")
    stripePriceId String? @map(name: "stripe_price_id")
    stripeCurrentPeriodEnd DateTime? @map(name: "stripe_current_period_end")
}

enum UploadStatus{
    PENDING
    PROCESSING
    FAILED
    SUCCESS
}

model File{
    id String @id @default(cuid())
    name String
    
    uploadStatus UploadStatus @default(PENDING)
    
    url String
    key String
    messages Message[]

    createdAt DateTime @default(now())
    uploadedAt DateTime @updatedAt
    User User? @relation(fields: [userId], references: [id])
    userId String?
}

model Message{
    id String @id @default(cuid())
    text String @db.Text()

    isUserMessage Boolean

    createdAt DateTime @default(now())
    uploadedAt DateTime @updatedAt
    User User? @relation(fields: [userId], references: [id])
    userId String?
    File File? @relation(fields: [fileId], references: [id])
    fileId String?
}

model Rocket {
    id String @id @default(cuid())
    createdAt DateTime @default(now())

    activeStage Int @default(0)
    activeChart String?
    scaleSlider Float?
    stages RocketStage[]

    User User? @relation(fields: [userId], references: [id])
    userId String?
}

model RocketStage {
    id String @id @default(cuid())
    rocket Rocket? @relation(fields: [rocketId], references: [id])
    rocketId String?

    parts RocketPart[]
}

model RocketPart{
    id String @id @default(cuid())
    rocketStage RocketStage? @relation(fields: [stageId], references: [id])
    stageId String?

    part_type       String
    name            String
    image           String
    diameter        Float
    length          Float
    weight          Float
    scale           Float
    width           Float
    height          Float
    scaled_width    Float
    scaled_height   Float
    targetStage     Int
    x               Float
    y               Float
    uniqueId        String
}